#include "FreeRTOS.h"
#include "oled.h"

#define    FCY    16000000UL    
#include <libpic30.h>

unsigned char ucPage;
unsigned char ucFull;
unsigned char ucCollumn;

#define PMPWaitBusy()   while(PMMODEbits.BUSY)

static inline unsigned portCHAR __attribute__ ((always_inline)) prvOLEDRead( void )
{
    unsigned char ucData;
    ucData = PMDIN1;
    PMPWaitBusy();
    PMCONbits.PMPEN = 0; /* disable PMP */
    ucData = PMDIN1;
    PMCONbits.PMPEN = 1; /* enable  PMP */
    return ucData;
}

static inline void __attribute__ ((always_inline)) prvOLEDWrite (unsigned char ucData )
{
    PMDIN1 = ucData;
    PMPWaitBusy();
}

#define prvOLEDEnable()     LATDbits.LATD11 = 0
#define prvOLEDDisable()    LATDbits.LATD11 = 1

#define prvOLEDCommand()    LATBbits.LATB15 = 0
#define prvOLEDData()       LATBbits.LATB15 = 1

#define prvOLEDSetAddress(page, addr ) \
    prvOLEDCommand(); \
    prvOLEDWrite ( ( 0xb0 | ( page & 7 ) ) ); \
    prvOLEDWrite ( ( addr & 0xf ) ); \
    prvOLEDWrite ( ( ( ( addr >> 4 ) & 0xf ) | 0x10 ) ); \
    prvOLEDData()

static void prvOLEDSetTopPage ( void )
{
    prvOLEDCommand();
    if ( ucFull )
        prvOLEDWrite ( ( 0x40 | ( ( ( ucPage + 1 ) & 7 ) << 3 ) ) );
    else
        prvOLEDWrite ( 0x40 );
    prvOLEDData();
}

static void prvOLEDClearLine ( unsigned char ucLine )
{
    portBASE_TYPE xI;
    prvOLEDSetAddress ( ucLine, 0 );
    for ( xI = 0; xI < 132; xI++ )
        prvOLEDWrite ( 0 );
}

static void prvOLEDClear ( void )
{
    unsigned char ucRow;
    prvOLEDEnable();
    for ( ucRow = 0; ucRow < 8; ucRow++ )
    {
        prvOLEDClearLine ( ucRow );
    }
    ucPage = 0;
    ucFull = 0;
    ucCollumn = 2;
    prvOLEDSetAddress ( ucPage, ucCollumn );
    prvOLEDSetTopPage();
}

void vOLEDInit ( void )
{
    LATDbits.LATD2 = 0; /* hold display in reset */
    TRISDbits.TRISD2 = 0; /* enable display reset line */
    TRISBbits.TRISB15 = 0; /* enable RS line */
    prvOLEDDisable(); /* display not selected by default */
    TRISDbits.TRISD11 = 0; /* enable chip select line */
    PMMODE = 0;
    PMAEN = 0;
    PMCON = 0;
    PMMODEbits.MODE = 2; /* Intel 80 master interface */
    PMMODEbits.WAITB = 0; /* we don't need to wait between data setup and read/write */
    PMMODEbits.WAITM = 2; /* wait 2 cycles between read and byte enabled strobe */
    PMMODEbits.WAITE = 0; /* we don't need to hold data after strobe */
    PMMODEbits.MODE16 = 0; /* 8-bit mode */
    PMCONbits.PTRDEN = 1; /* enable RD line */
    PMCONbits.PTWREN = 1; /* enable WR line */
    PMCONbits.PMPEN = 1; /* enable PMP */
    LATDbits.LATD2 = 1; /* realease display from reset */

    __delay_us(200); /* give display some time after reset */

    prvOLEDEnable(); /* select display */
    prvOLEDCommand();

    /* Setup Display */
    prvOLEDWrite ( 0xAE ); /* turn off the display (AF=ON, AE=OFF) */
    prvOLEDWrite ( 0xDB ); /* set  VCOMH */
    prvOLEDWrite ( 0x23 );
    prvOLEDWrite ( 0xD9 ); /* set  VP */
    prvOLEDWrite ( 0x22 );

    /* Re-map */
    prvOLEDWrite ( 0xA1 ); /* [A0]:column address 0 is map to SEG0 */
                                  /* [A1]:column address 131 is map to SEG0 */
    /* COM Output Scan Direction */
    prvOLEDWrite ( 0xC8 ); /* C0 is COM0 to COMn, C8 is COMn to COM0 */

    /* COM Pins Hardware Configuration */
    prvOLEDWrite ( 0xDA ); /* set pins hardware configuration */
    prvOLEDWrite ( 0x12 );

    /* Multiplex Ratio */
    prvOLEDWrite ( 0xA8 ); /* set multiplex ratio */
    prvOLEDWrite ( 0x3F ); /* set to 64 mux */

    /* Display Clock Divide */
    prvOLEDWrite ( 0xD5 ); /* set display clock divide */
    prvOLEDWrite ( 0xA0 ); /* set to 100Hz */

    /* Contrast Control Register */
    prvOLEDWrite ( 0x81 ); /* Set contrast control */
    prvOLEDWrite ( 0x80 ); /* display 0 ~ 127; 2C */

    /* Display Offset */
    prvOLEDWrite ( 0xD3 ); /* set display offset */
    prvOLEDWrite ( 0x00 ); /* no offset */

    /* Normal or Inverse Display */
    prvOLEDWrite ( 0xA6 ); /* Normal display */

    prvOLEDWrite ( 0xAD ); /* Set DC-DC */
    prvOLEDWrite ( 0x8B ); /* 8B=ON, 8A=OFF */

    /* Display ON/OFF */
    prvOLEDWrite ( 0xAF ); /* AF=ON, AE=OFF */

    __delay_ms ( 150 );

    /* Entire Display ON/OFF */
    prvOLEDWrite ( 0xA4 ); /* A4=ON */
    /* Display Start Line */
    prvOLEDWrite ( 0x40 ); /* Set display start line */
    /* Lower Column Address */
    prvOLEDWrite ( 0x02 ); /* Set lower column address */
    /* Higher Column Address */
    prvOLEDWrite ( 0x10 ); /* Set higher column address */

    __delay_ms ( 1 );

    prvOLEDClear();
    prvOLEDData();
}

static void prvOLEDNl ( void )
{
    ucCollumn = 2;
    if (ucPage >= 7)
        ucFull = 1;
    ucPage++;
    if ( ucFull )
    {
        prvOLEDClearLine ( ucPage );
        prvOLEDSetTopPage ();
    }
    prvOLEDSetAddress ( ucPage, ucCollumn );
}


unsigned char __attribute__((far)) ucCharacters[][6] =
    {
        { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },      // Code for char
        { 0x00, 0x00, 0x06, 0x5F, 0x06, 0x00 },      // Code for char !
        { 0x00, 0x07, 0x03, 0x00, 0x07, 0x03 },      // Code for char "
        { 0x00, 0x24, 0x7E, 0x24, 0x7E, 0x24 },      // Code for char #
        { 0x00, 0x24, 0x2B, 0x6A, 0x12, 0x00 },      // Code for char $
        { 0x00, 0x63, 0x13, 0x08, 0x64, 0x63 },      // Code for char %
        { 0x00, 0x36, 0x49, 0x56, 0x20, 0x50 },      // Code for char &
        { 0x00, 0x00, 0x07, 0x03, 0x00, 0x00 },      // Code for char '
        { 0x00, 0x00, 0x3E, 0x41, 0x00, 0x00 },      // Code for char (
        { 0x00, 0x00, 0x41, 0x3E, 0x00, 0x00 },      // Code for char )
        { 0x00, 0x08, 0x3E, 0x1C, 0x3E, 0x08 },      // Code for char *
        { 0x00, 0x08, 0x08, 0x3E, 0x08, 0x08 },      // Code for char +
        { 0x00, 0x00, 0xE0, 0x60, 0x00, 0x00 },      // Code for char ,
        { 0x00, 0x08, 0x08, 0x08, 0x08, 0x08 },      // Code for char -
        { 0x00, 0x00, 0x60, 0x60, 0x00, 0x00 },      // Code for char .
        { 0x00, 0x20, 0x10, 0x08, 0x04, 0x02 },      // Code for char /
        { 0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E },      // Code for char 0
        { 0x00, 0x00, 0x42, 0x7F, 0x40, 0x00 },      // Code for char 1
        { 0x00, 0x62, 0x51, 0x49, 0x49, 0x46 },      // Code for char 2
        { 0x00, 0x22, 0x49, 0x49, 0x49, 0x36 },      // Code for char 3
        { 0x00, 0x18, 0x14, 0x12, 0x7F, 0x10 },      // Code for char 4
        { 0x00, 0x2F, 0x49, 0x49, 0x49, 0x31 },      // Code for char 5
        { 0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30 },      // Code for char 6
        { 0x00, 0x01, 0x71, 0x09, 0x05, 0x03 },      // Code for char 7
        { 0x00, 0x36, 0x49, 0x49, 0x49, 0x36 },      // Code for char 8
        { 0x00, 0x06, 0x49, 0x49, 0x29, 0x1E },      // Code for char 9
        { 0x00, 0x00, 0x6C, 0x6C, 0x00, 0x00 },      // Code for char :
        { 0x00, 0x00, 0xEC, 0x6C, 0x00, 0x00 },      // Code for char ;
        { 0x00, 0x08, 0x14, 0x22, 0x41, 0x00 },      // Code for char <
        { 0x00, 0x24, 0x24, 0x24, 0x24, 0x24 },      // Code for char =
        { 0x00, 0x00, 0x41, 0x22, 0x14, 0x08 },      // Code for char >
        { 0x00, 0x02, 0x01, 0x59, 0x09, 0x06 },      // Code for char ?
        { 0x00, 0x3E, 0x41, 0x5D, 0x55, 0x1E },      // Code for char @
        { 0x00, 0x7E, 0x11, 0x11, 0x11, 0x7E },      // Code for char A
        { 0x00, 0x7F, 0x49, 0x49, 0x49, 0x36 },      // Code for char B
        { 0x00, 0x3E, 0x41, 0x41, 0x41, 0x22 },      // Code for char C
        { 0x00, 0x7F, 0x41, 0x41, 0x41, 0x3E },      // Code for char D
        { 0x00, 0x7F, 0x49, 0x49, 0x49, 0x41 },      // Code for char E
        { 0x00, 0x7F, 0x09, 0x09, 0x09, 0x01 },      // Code for char F
        { 0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A },      // Code for char G
        { 0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F },      // Code for char H
        { 0x00, 0x00, 0x41, 0x7F, 0x41, 0x00 },      // Code for char I
        { 0x00, 0x30, 0x40, 0x40, 0x40, 0x3F },      // Code for char J
        { 0x00, 0x7F, 0x08, 0x14, 0x22, 0x41 },      // Code for char K
        { 0x00, 0x7F, 0x40, 0x40, 0x40, 0x40 },      // Code for char L
        { 0x00, 0x7F, 0x02, 0x04, 0x02, 0x7F },      // Code for char M
        { 0x00, 0x7F, 0x02, 0x04, 0x08, 0x7F },      // Code for char N
        { 0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E },      // Code for char O
        { 0x00, 0x7F, 0x09, 0x09, 0x09, 0x06 },      // Code for char P
        { 0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E },      // Code for char Q
        { 0x00, 0x7F, 0x09, 0x09, 0x19, 0x66 },      // Code for char R
        { 0x00, 0x26, 0x49, 0x49, 0x49, 0x32 },      // Code for char S
        { 0x00, 0x01, 0x01, 0x7F, 0x01, 0x01 },      // Code for char T
        { 0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F },      // Code for char U
        { 0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F },      // Code for char V
        { 0x00, 0x3F, 0x40, 0x3C, 0x40, 0x3F },      // Code for char W
        { 0x00, 0x63, 0x14, 0x08, 0x14, 0x63 },      // Code for char X
        { 0x00, 0x07, 0x08, 0x70, 0x08, 0x07 },      // Code for char Y
        { 0x00, 0x71, 0x49, 0x45, 0x43, 0x00 },      // Code for char Z
        { 0x00, 0x00, 0x7F, 0x41, 0x41, 0x00 },      // Code for char [
        { 0x00, 0x02, 0x04, 0x08, 0x10, 0x20 },      // Code for char BackSlash
        { 0x00, 0x00, 0x41, 0x41, 0x7F, 0x00 },      // Code for char ]
        { 0x00, 0x04, 0x02, 0x01, 0x02, 0x04 },      // Code for char ^
        { 0x80, 0x80, 0x80, 0x80, 0x80, 0x80 },      // Code for char _
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char `
        { 0x00, 0x20, 0x54, 0x54, 0x54, 0x78 },      // Code for char a
        { 0x00, 0x7F, 0x44, 0x44, 0x44, 0x38 },      // Code for char b
        { 0x00, 0x38, 0x44, 0x44, 0x44, 0x28 },      // Code for char c
        { 0x00, 0x38, 0x44, 0x44, 0x44, 0x7F },      // Code for char d
        { 0x00, 0x38, 0x54, 0x54, 0x54, 0x08 },      // Code for char e
        { 0x00, 0x08, 0x7E, 0x09, 0x09, 0x00 },      // Code for char f
        { 0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C },      // Code for char g
        { 0x00, 0x7F, 0x04, 0x04, 0x78, 0x00 },      // Code for char h
        { 0x00, 0x00, 0x00, 0x7D, 0x40, 0x00 },      // Code for char i
        { 0x00, 0x40, 0x80, 0x84, 0x7D, 0x00 },      // Code for char j
        { 0x00, 0x7F, 0x10, 0x28, 0x44, 0x00 },      // Code for char k
        { 0x00, 0x00, 0x00, 0x7F, 0x40, 0x00 },      // Code for char l
        { 0x00, 0x7C, 0x04, 0x18, 0x04, 0x78 },      // Code for char m
        { 0x00, 0x7C, 0x04, 0x04, 0x78, 0x00 },      // Code for char n
        { 0x00, 0x38, 0x44, 0x44, 0x44, 0x38 },      // Code for char o
        { 0x00, 0xFC, 0x44, 0x44, 0x44, 0x38 },      // Code for char p
        { 0x00, 0x38, 0x44, 0x44, 0x44, 0xFC },      // Code for char q
        { 0x00, 0x44, 0x78, 0x44, 0x04, 0x08 },      // Code for char r
        { 0x00, 0x08, 0x54, 0x54, 0x54, 0x20 },      // Code for char s
        { 0x00, 0x04, 0x3E, 0x44, 0x24, 0x00 },      // Code for char t
        { 0x00, 0x3C, 0x40, 0x20, 0x7C, 0x00 },      // Code for char u
        { 0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C },      // Code for char v
        { 0x00, 0x3C, 0x60, 0x30, 0x60, 0x3C },      // Code for char w
        { 0x00, 0x6C, 0x10, 0x10, 0x6C, 0x00 },      // Code for char x
        { 0x00, 0x9C, 0xA0, 0x60, 0x3C, 0x00 },      // Code for char y
        { 0x00, 0x64, 0x54, 0x54, 0x4C, 0x00 },      // Code for char z
        { 0x00, 0x08, 0x3E, 0x41, 0x41, 0x00 },      // Code for char {
        { 0x00, 0x00, 0x00, 0x77, 0x00, 0x00 },      // Code for char |
        { 0x00, 0x00, 0x41, 0x41, 0x3E, 0x08 },      // Code for char }
        { 0x00, 0x02, 0x01, 0x02, 0x01, 0x00 },      // Code for char ~
        { 0x00, 0x3C, 0x26, 0x23, 0x26, 0x3C },      // Code for char 
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x3D, 0x40, 0x20, 0x7D, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x01, 0x7C, 0x40, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x78, 0x2F, 0x25, 0x2F, 0x78 },      // Code for char �
        { 0x00, 0x7C, 0x54, 0x54, 0x55, 0x45 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x29, 0x2A, 0x7C, 0x2A, 0x29 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x03, 0x07, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x20, 0x54, 0x55, 0x55, 0x78 },      // Code for char �
        { 0x00, 0x00, 0x00, 0x7D, 0x41, 0x00 },      // Code for char �
        { 0x00, 0x38, 0x44, 0x45, 0x39, 0x00 },      // Code for char �
        { 0x00, 0x3C, 0x40, 0x21, 0x7D, 0x00 },      // Code for char �
        { 0x00, 0x7A, 0x09, 0x0A, 0x71, 0x00 },      // Code for char �
        { 0x00, 0x7A, 0x11, 0x22, 0x79, 0x00 },      // Code for char �
        { 0x00, 0x08, 0x55, 0x55, 0x55, 0x5E },      // Code for char �
        { 0x00, 0x4E, 0x51, 0x51, 0x4E, 0x00 },      // Code for char �
        { 0x00, 0x30, 0x48, 0x4D, 0x40, 0x20 },      // Code for char �
        { 0x00, 0x3C, 0x04, 0x04, 0x04, 0x04 },      // Code for char �
        { 0x04, 0x04, 0x04, 0x04, 0x04, 0x1C },      // Code for char �
        { 0x00, 0x17, 0x08, 0x4C, 0x6A, 0x50 },      // Code for char �
        { 0x00, 0x17, 0x08, 0x34, 0x2A, 0x78 },      // Code for char �
        { 0x00, 0x00, 0x30, 0x7D, 0x30, 0x00 },      // Code for char �
        { 0x00, 0x08, 0x14, 0x00, 0x08, 0x14 },      // Code for char �
        { 0x00, 0x14, 0x08, 0x00, 0x14, 0x08 },      // Code for char �
        { 0x44, 0x11, 0x44, 0x11, 0x44, 0x11 },      // Code for char �
        { 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55 },      // Code for char �
        { 0xBB, 0xEE, 0xBB, 0xEE, 0xBB, 0xEE },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x08, 0x08, 0x08, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x08, 0xFF, 0x00, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x08, 0xF8, 0x08, 0xF8, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0xFE, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0xFB, 0x00, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0xFA, 0x02, 0xFE, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0x0B, 0x08, 0x0F, 0x00, 0x00 },      // Code for char �
        { 0x08, 0x0F, 0x08, 0x0F, 0x00, 0x00 },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0x0F, 0x00, 0x00 },      // Code for char �
        { 0x08, 0x08, 0x08, 0xF8, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x00, 0x0F, 0x08, 0x08 },      // Code for char �
        { 0x08, 0x08, 0x08, 0x0F, 0x08, 0x08 },      // Code for char �
        { 0x08, 0x08, 0x08, 0xF8, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFF, 0x08, 0x08 },      // Code for char �
        { 0x08, 0x08, 0x08, 0x08, 0x08, 0x08 },      // Code for char �
        { 0x08, 0x08, 0x08, 0xFF, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFF, 0x0A, 0x0A },      // Code for char �
        { 0x00, 0xFF, 0x00, 0xFF, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x0F, 0x08, 0x0B, 0x0A, 0x0A },      // Code for char �
        { 0x00, 0xFE, 0x02, 0xFA, 0x0A, 0x0A },      // Code for char �
        { 0x0A, 0x0B, 0x08, 0x0B, 0x0A, 0x0A },      // Code for char �
        { 0x0A, 0xFA, 0x02, 0xFA, 0x0A, 0x0A },      // Code for char �
        { 0x00, 0xFF, 0x00, 0xFB, 0x0A, 0x0A },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A },      // Code for char �
        { 0x0A, 0xFB, 0x00, 0xFB, 0x0A, 0x0A },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0x0B, 0x0A, 0x0A },      // Code for char �
        { 0x08, 0x0F, 0x08, 0x0F, 0x08, 0x08 },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0xFA, 0x0A, 0x0A },      // Code for char �
        { 0x08, 0xF8, 0x08, 0xF8, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x0F, 0x08, 0x0F, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x00, 0x00, 0x0F, 0x0A, 0x0A },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFE, 0x0A, 0x0A },      // Code for char �
        { 0x00, 0xF8, 0x08, 0xF8, 0x08, 0x08 },      // Code for char �
        { 0x08, 0xFF, 0x00, 0xFF, 0x08, 0x08 },      // Code for char �
        { 0x0A, 0x0A, 0x0A, 0xFB, 0x0A, 0x0A },      // Code for char �
        { 0x08, 0x08, 0x08, 0x0F, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x00, 0xF8, 0x08, 0x08 },      // Code for char �
        { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF },      // Code for char �
        { 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0 },      // Code for char �
        { 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF },      // Code for char �
        { 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F },      // Code for char �
        { 0x00, 0x18, 0x24, 0x24, 0x18, 0x24 },      // Code for char �
        { 0x00, 0xFE, 0x4A, 0x4A, 0x34, 0x00 },      // Code for char �
        { 0x00, 0x7F, 0x01, 0x01, 0x03, 0x00 },      // Code for char �
        { 0x00, 0x02, 0x7E, 0x02, 0x7E, 0x02 },      // Code for char �
        { 0x00, 0x63, 0x55, 0x49, 0x63, 0x00 },      // Code for char �
        { 0x00, 0x18, 0x24, 0x24, 0x1C, 0x04 },      // Code for char �
        { 0x00, 0xFC, 0x20, 0x20, 0x1C, 0x00 },      // Code for char �
        { 0x00, 0x08, 0x04, 0x78, 0x04, 0x00 },      // Code for char �
        { 0x00, 0x08, 0x55, 0x77, 0x55, 0x08 },      // Code for char �
        { 0x00, 0x3E, 0x49, 0x49, 0x3E, 0x00 },      // Code for char �
        { 0x00, 0x4C, 0x72, 0x02, 0x72, 0x4C },      // Code for char �
        { 0x00, 0x22, 0x55, 0x59, 0x30, 0x00 },      // Code for char �
        { 0x00, 0x18, 0x24, 0x18, 0x24, 0x18 },      // Code for char �
        { 0x00, 0x18, 0x24, 0x7E, 0x24, 0x18 },      // Code for char �
        { 0x00, 0x1C, 0x2A, 0x2A, 0x2A, 0x00 },      // Code for char �
        { 0x00, 0x3C, 0x02, 0x02, 0x3C, 0x00 },      // Code for char �
        { 0x00, 0x2A, 0x2A, 0x2A, 0x2A, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x24, 0x2E, 0x24, 0x00 },      // Code for char �
        { 0x00, 0x51, 0x4A, 0x4A, 0x44, 0x00 },      // Code for char �
        { 0x00, 0x44, 0x4A, 0x4A, 0x51, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x00, 0xFC, 0x02, 0x04 },      // Code for char �
        { 0x00, 0x20, 0x40, 0x3F, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x08, 0x08, 0x2A, 0x08, 0x08 },      // Code for char �
        { 0x00, 0x24, 0x12, 0x24, 0x12, 0x00 },      // Code for char �
        { 0x00, 0x06, 0x09, 0x09, 0x06, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x18, 0x18, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x08, 0x00, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x30, 0x40, 0x3E, 0x02, 0x02 },      // Code for char �
        { 0x00, 0x01, 0x0E, 0x01, 0x0E, 0x00 },      // Code for char �
        { 0x00, 0x09, 0x0D, 0x0A, 0x00, 0x00 },      // Code for char �
        { 0x00, 0x3C, 0x3C, 0x3C, 0x3C, 0x00 },      // Code for char �
        { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },       // Code for char �
};

void vOLEDPutChar ( unsigned char ucC )
{
    portBASE_TYPE xI;
    switch ( ucC )
    {
        case 0x08:  /* backspace */
            if ( ucCollumn >= 8 )
            {
                ucCollumn -= 6;
                prvOLEDSetAddress ( ucPage, ucCollumn );
                for ( xI = 0; xI < 6; xI++ )
                    prvOLEDWrite ( 0 );
                prvOLEDSetAddress ( ucPage, ucCollumn );
            }
            break;
        case 0x0a:  /* new line */
            prvOLEDNl ();
            break;
        case 0x0d:  /* carriage return */
            prvOLEDClearLine ( ucPage );
            ucCollumn = 2;
            break;
        default:
            ucC -= ' ';
            for ( xI = 0; xI < 6; xI++ )
            {
                prvOLEDWrite ( ucCharacters[ ucC ][ xI ] );
                #if oledSLOW == 1
                    __delay_us(200);
                #endif
            }
            ucCollumn += 6;
            if ( ucCollumn >= 128 )
                prvOLEDNl ();
    }
}

void vOLEDPutString ( char * pcString )
{
    portBASE_TYPE xI = 0;
    while ( pcString[ xI ] )
        vOLEDPutChar ( pcString[ xI++ ] );
}

void vOLEDPokus ( void )
{
    vOLEDPutString("Lorem ipsum dolor sit amet, consectetur adipiscing elit. ");
    __delay_ms(500);
    vOLEDPutString("Pellentesque scelerisque, ");
    __delay_ms(500);
    vOLEDPutString("est nec pharetra vulputate, ");
    __delay_ms(500);
    vOLEDPutString("sapien erat venenatis ");
    __delay_ms(500);
    vOLEDPutString("lorem, non iaculis ");
    __delay_ms(500);
    vOLEDPutString("nisl orci at urna. ");
    __delay_ms(500);
    vOLEDPutString("Integer metus arcu, ");
    __delay_ms(500);
    vOLEDPutString("dignissim nec tempor ");
    __delay_ms(500);
    vOLEDPutString("quis, tempus id nisi. ");
    __delay_ms(500);
    prvOLEDClear();
    vOLEDPutString("Donec ante arcu, vehicula ");
    __delay_ms(500);
    vOLEDPutString("ultrices porttitor ");
    __delay_ms(500);
    vOLEDPutString("sit amet, condimentum ");
    __delay_ms(500);
    vOLEDPutString("non elit. Aenean ut ");
    __delay_ms(500);
    vOLEDPutString("posuere neque. Quisque ");
    __delay_ms(500);
    vOLEDPutString("nec mauris egestas, ");
    __delay_ms(500);
    vOLEDPutString("cursus lacus eu, ");
    __delay_ms(500);
    vOLEDPutString("rhoncus arcu. Nam ");
    __delay_ms(500);
    vOLEDPutString("malesuada, leo vitae ");
    __delay_ms(500);
    vOLEDPutString("dapibus consectetur, ");
    __delay_ms(500);
    vOLEDPutString("leo sapien dignissim ");
    __delay_ms(500);
    vOLEDPutString("dui, vitae fermentum ");
    __delay_ms(500);
    vOLEDPutString("felis magna sit amet ");
    __delay_ms(500);
    vOLEDPutString("nunc. Vivamus nec ");
    __delay_ms(500);
    vOLEDPutString("interdum nulla. ");
    __delay_ms(500);
    vOLEDPutString("Vestibulum ante ipsum ");
    __delay_ms(500);
    vOLEDPutString("primis in faucibus ");
    __delay_ms(500);
    vOLEDPutString("orci luctus et ");
    __delay_ms(500);
    vOLEDPutString("ultrices posuere ");
    __delay_ms(500);
    vOLEDPutString("cubilia Curae; ");
    __delay_ms(500);
    vOLEDPutString("Curabitur sed ");
    __delay_ms(500);
    vOLEDPutString("tristique orci. ");
    __delay_ms(500);
    vOLEDPutString("Morbi cras amet. ");
    __delay_ms(500);
}